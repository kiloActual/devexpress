/**
* DevExpress Dashboard (_item-data-manager.js)
* Version:  21.2.3
* Build date: Oct 25, 2021
* Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED
* License: https://www.devexpress.com/Support/EULAs/universal.xml
*/
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _data_storage_1 = require("../../data-storage/_data-storage");
var item_data_axis_names_1 = require("../item-data-axis-names");
var _item_data_1 = require("../_item-data");
var _item_data_axis_builder_1 = require("./_item-data-axis-builder");
var _item_data_axis_helper_1 = require("./_item-data-axis-helper");
var _item_meta_data_1 = require("./_item-meta-data");
var itemDataManager = (function () {
    function itemDataManager() {
    }
    itemDataManager.prototype.initialize = function (itemDataDTO) {
        var metaData = this._createMetaData(itemDataDTO.MetaData), ds = new _data_storage_1.dataStorage(itemDataDTO.DataStorageDTO), items = {};
        var axes = metaData.getAxes();
        Object.keys(axes).forEach(function (name) {
            items[name] = _item_data_axis_builder_1.itemDataAxisBuilder.build(name, ds, axes[name], itemDataDTO.SortOrderSlices, metaData);
        });
        this._dataStorage = ds;
        this._metaData = metaData;
        this._itemData = new _item_data_1.itemData(metaData, ds, items);
        this._items = items;
    };
    itemDataManager.prototype.updateExpandedData = function (expandedItemDataDTO, expandInfo) {
        var that = this, areaNames = item_data_axis_names_1.itemDataAxisNames, sortOrderSlices = expandedItemDataDTO.SortOrderSlices, area = expandInfo.pivotArea == _item_data_axis_builder_1.pivotAreaNames.columns ? areaNames.pivotColumnAxis : areaNames.pivotRowAxis, values = expandInfo.values, metaData = that._metaData, ds = new _data_storage_1.dataStorage(expandedItemDataDTO.DataStorageDTO);
        var iterators = that._dataStorage.insert(ds, sortOrderSlices);
        var expandedAreaNewRootItem = _item_data_axis_builder_1.itemDataAxisBuilder.build(area, that._dataStorage, metaData.getAxes()[area], sortOrderSlices, metaData, iterators);
        if (!!expandedAreaNewRootItem) {
            var expandedAreaRootItem = that._items[area], expandedItem = _item_data_axis_helper_1.itemDataAxisHelper.findFirstPointByUniqueValues(expandedAreaRootItem, values), expandedNewItem = _item_data_axis_helper_1.itemDataAxisHelper.findFirstPointByUniqueValues(expandedAreaNewRootItem, values);
            if (!!expandedNewItem) {
                var newChildren = expandedNewItem.getChildren();
                newChildren.forEach(function (child) {
                    child._setParent(expandedItem);
                });
                expandedItem._setChildren(newChildren);
            }
        }
    };
    itemDataManager.prototype.getDataStorage = function () {
        return this._dataStorage;
    };
    itemDataManager.prototype.getItemData = function () {
        return this._itemData;
    };
    itemDataManager.prototype.getMetaData = function () {
        return this._metaData;
    };
    itemDataManager.prototype._createMetaData = function (metaDataDTO) {
        var metaData = new _item_meta_data_1.itemMetaData(metaDataDTO);
        metaData.initialize();
        return metaData;
    };
    return itemDataManager;
}());
exports.itemDataManager = itemDataManager;
