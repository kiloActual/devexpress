"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var layout_position_creator_1 = require("../../core/layout-engine/layout-position-creator");
var document_layout_details_level_1 = require("../../core/layout/document-layout-details-level");
var layout_point_1 = require("../../core/layout/layout-point");
function getLayoutPoint(layoutFormatterManager, subDocument, position, endOfLine, pageIndex) {
    if (position > subDocument.getDocumentEndPosition())
        position = subDocument.getDocumentEndPosition();
    var layout = layoutFormatterManager.layout;
    var layoutPosition;
    if (subDocument.isMain()) {
        layoutPosition = layout_position_creator_1.LayoutPositionMainSubDocumentCreator.ensureLayoutPosition(layoutFormatterManager, subDocument, position, document_layout_details_level_1.DocumentLayoutDetailsLevel.Character, new layout_position_creator_1.LayoutPositionCreatorConflictFlags().setDefault(endOfLine), new layout_position_creator_1.LayoutPositionCreatorConflictFlags().setDefault(false));
    }
    else {
        while (!layout.isFullyFormatted && layout.validPageCount < pageIndex) {
            if (!layoutFormatterManager.forceFormatPage(layout.validPageCount))
                break;
        }
        layoutPosition = new layout_position_creator_1.LayoutPositionOtherSubDocumentCreator(layout, subDocument, position, pageIndex, document_layout_details_level_1.DocumentLayoutDetailsLevel.Character)
            .create(new layout_position_creator_1.LayoutPositionCreatorConflictFlags().setDefault(endOfLine), new layout_position_creator_1.LayoutPositionCreatorConflictFlags().setDefault(false));
    }
    if (!layoutPosition)
        return { layoutPoint: null, layoutPosition: null };
    var layoutPoint = new layout_point_1.LayoutPoint(layoutPosition.pageIndex, layoutPosition.getLayoutX(layoutFormatterManager.measurer), layoutPosition.getLayoutY(document_layout_details_level_1.DocumentLayoutDetailsLevel.Box));
    return { layoutPoint: layoutPoint, layoutPosition: layoutPosition };
}
exports.getLayoutPoint = getLayoutPoint;
