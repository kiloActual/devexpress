"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var common_1 = require("@devexpress/utils/lib/utils/common");
var character_style_1 = require("../../character/character-style");
var numbering_list_style_1 = require("../../numbering-lists/numbering-list-style");
var paragraph_style_1 = require("../../paragraph/paragraph-style");
var table_style_1 = require("../../tables/styles/table-style");
var json_style_enums_1 = require("../enums/json-style-enums");
var json_tab_converter_1 = require("./json-tab-converter");
var json_table_conditional_style_converter_1 = require("./table/json-table-conditional-style-converter");
var JSONStylesExporter = (function () {
    function JSONStylesExporter() {
    }
    JSONStylesExporter.importStyles = function (documentModel, content) {
        JSONStylesExporter.importCharacterStyles(documentModel, content[json_style_enums_1.JSONStylesProperty.Character]);
        JSONStylesExporter.importParagraphStyles(documentModel, content[json_style_enums_1.JSONStylesProperty.Paragraph]);
        JSONStylesExporter.importNumberingStyles(documentModel, content[json_style_enums_1.JSONStylesProperty.NumberingList]);
        JSONStylesExporter.importTableStyles(documentModel, content[json_style_enums_1.JSONStylesProperty.Table]);
        JSONStylesExporter.finishCharacterStylesImport(documentModel, content[json_style_enums_1.JSONStylesProperty.Character]);
        JSONStylesExporter.finishParagraphStylesImport(documentModel, content[json_style_enums_1.JSONStylesProperty.Paragraph]);
        JSONStylesExporter.finishNumberingListStylesImport(documentModel, content[json_style_enums_1.JSONStylesProperty.NumberingList]);
        JSONStylesExporter.finishTableStylesImport(documentModel, content[json_style_enums_1.JSONStylesProperty.Table]);
    };
    JSONStylesExporter.exportStyles = function (documentModel) {
        var jsonStyles = {};
        jsonStyles[json_style_enums_1.JSONStylesProperty.Character] = JSONStylesExporter.exportCharacterStyles(documentModel);
        jsonStyles[json_style_enums_1.JSONStylesProperty.Paragraph] = JSONStylesExporter.exportParagraphStyles(documentModel);
        jsonStyles[json_style_enums_1.JSONStylesProperty.NumberingList] = JSONStylesExporter.exportNumberingStyles(documentModel);
        jsonStyles[json_style_enums_1.JSONStylesProperty.Table] = JSONStylesExporter.exportTableStyles(documentModel);
        return jsonStyles;
    };
    ;
    JSONStylesExporter.exportCharacterStyles = function (documentModel) {
        var jsonCharacterStyles = [];
        for (var _i = 0, _a = documentModel.characterStyles; _i < _a.length; _i++) {
            var characterStyle = _a[_i];
            var jsonCharacterStyle = {};
            jsonCharacterStyle[json_style_enums_1.JSONStyleBaseProperty.StyleName] = characterStyle.styleName;
            jsonCharacterStyle[json_style_enums_1.JSONStyleBaseProperty.Deleted] = common_1.boolToInt(characterStyle.deleted);
            jsonCharacterStyle[json_style_enums_1.JSONStyleBaseProperty.Hidden] = common_1.boolToInt(characterStyle.hidden);
            jsonCharacterStyle[json_style_enums_1.JSONStyleBaseProperty.ParentStyleName] = characterStyle.parent ? characterStyle.parent.styleName : "";
            jsonCharacterStyle[json_style_enums_1.JSONStyleBaseProperty.Semihidden] = common_1.boolToInt(characterStyle.semihidden);
            jsonCharacterStyle[json_style_enums_1.JSONStyleBaseProperty.LocalizedStyleName] = characterStyle.localizedName;
            jsonCharacterStyle[json_style_enums_1.JSONStyleBaseProperty.IsDefault] = common_1.boolToInt(characterStyle.isDefault);
            jsonCharacterStyle[json_style_enums_1.JSONStyleBaseProperty.Base64EncodedImage] = characterStyle.base64EncodedImage;
            jsonCharacterStyle[json_style_enums_1.JSONCharacterStyleProperty.LinkedStyleName] = characterStyle.linkedStyle ? characterStyle.linkedStyle.styleName : "";
            jsonCharacterStyle[json_style_enums_1.JSONCharacterStyleProperty.CharacterPropertiesCacheIndex] = documentModel.characterStyles.indexOf(characterStyle);
            jsonCharacterStyles.push(jsonCharacterStyle);
        }
        return jsonCharacterStyles;
    };
    JSONStylesExporter.exportParagraphStyles = function (documentModel) {
        var maskedCharacterPropertiesCache = documentModel.cache.maskedCharacterPropertiesCache;
        var maskedParagraphPropertiesCache = documentModel.cache.maskedParagraphPropertiesCache;
        var jsonParagraphStyles = [];
        for (var _i = 0, _a = documentModel.paragraphStyles; _i < _a.length; _i++) {
            var paragraphStyle = _a[_i];
            var jsonParagraphStyle = {};
            jsonParagraphStyle[json_style_enums_1.JSONStyleBaseProperty.StyleName] = paragraphStyle.styleName;
            jsonParagraphStyle[json_style_enums_1.JSONStyleBaseProperty.Deleted] = common_1.boolToInt(paragraphStyle.deleted);
            jsonParagraphStyle[json_style_enums_1.JSONStyleBaseProperty.Hidden] = common_1.boolToInt(paragraphStyle.hidden);
            jsonParagraphStyle[json_style_enums_1.JSONStyleBaseProperty.ParentStyleName] = paragraphStyle.parent ? paragraphStyle.parent.styleName : "";
            jsonParagraphStyle[json_style_enums_1.JSONStyleBaseProperty.Semihidden] = common_1.boolToInt(paragraphStyle.semihidden);
            jsonParagraphStyle[json_style_enums_1.JSONStyleBaseProperty.LocalizedStyleName] = paragraphStyle.localizedName;
            jsonParagraphStyle[json_style_enums_1.JSONStyleBaseProperty.IsDefault] = common_1.boolToInt(paragraphStyle.isDefault);
            jsonParagraphStyle[json_style_enums_1.JSONStyleBaseProperty.Base64EncodedImage] = paragraphStyle.base64EncodedImage;
            jsonParagraphStyle[json_style_enums_1.JSONParagraphStyleProperty.CharacterPropertiesCacheIndex] =
                maskedCharacterPropertiesCache.indexOf(paragraphStyle.maskedCharacterProperties);
            jsonParagraphStyle[json_style_enums_1.JSONParagraphStyleProperty.ParagraphPropertiesCacheIndex] =
                maskedParagraphPropertiesCache.indexOf(paragraphStyle.maskedParagraphProperties);
            jsonParagraphStyle[json_style_enums_1.JSONParagraphStyleProperty.LinkedStyleName] =
                paragraphStyle.linkedStyle ? paragraphStyle.linkedStyle.styleName : "";
            jsonParagraphStyle[json_style_enums_1.JSONParagraphStyleProperty.NextParagraphStyleName] =
                paragraphStyle.nextParagraphStyle ? paragraphStyle.nextParagraphStyle.styleName : "";
            jsonParagraphStyle[json_style_enums_1.JSONParagraphStyleProperty.AutoUpdate] = common_1.boolToInt(paragraphStyle.autoUpdate);
            jsonParagraphStyle[json_style_enums_1.JSONParagraphStyleProperty.Tabs] = json_tab_converter_1.JSONTabConverter.convertFromTabPropertiesToJSON(paragraphStyle.tabs);
            jsonParagraphStyle[json_style_enums_1.JSONParagraphStyleProperty.NumberingListIndex] = paragraphStyle.numberingListIndex;
            jsonParagraphStyle[json_style_enums_1.JSONParagraphStyleProperty.ListLevelIndex] = paragraphStyle.listLevelIndex;
            jsonParagraphStyles.push(jsonParagraphStyle);
        }
        return jsonParagraphStyles;
    };
    JSONStylesExporter.exportNumberingStyles = function (documentModel) {
        var jsonNumberingStyles = [];
        for (var _i = 0, _a = documentModel.numberingListStyles; _i < _a.length; _i++) {
            var numberingStyle = _a[_i];
            var jsonNumberingStyle = {};
            jsonNumberingStyle[json_style_enums_1.JSONStyleBaseProperty.StyleName] = numberingStyle.styleName;
            jsonNumberingStyle[json_style_enums_1.JSONStyleBaseProperty.Deleted] = common_1.boolToInt(numberingStyle.deleted);
            jsonNumberingStyle[json_style_enums_1.JSONStyleBaseProperty.Hidden] = common_1.boolToInt(numberingStyle.hidden);
            jsonNumberingStyle[json_style_enums_1.JSONStyleBaseProperty.ParentStyleName] = numberingStyle.parent ? numberingStyle.parent.styleName : "";
            jsonNumberingStyle[json_style_enums_1.JSONStyleBaseProperty.Semihidden] = common_1.boolToInt(numberingStyle.semihidden);
            jsonNumberingStyle[json_style_enums_1.JSONStyleBaseProperty.LocalizedStyleName] = numberingStyle.localizedName;
            jsonNumberingStyle[json_style_enums_1.JSONStyleBaseProperty.IsDefault] = common_1.boolToInt(numberingStyle.isDefault);
            jsonNumberingStyle[json_style_enums_1.JSONStyleBaseProperty.Base64EncodedImage] = numberingStyle.base64EncodedImage;
            jsonNumberingStyle[json_style_enums_1.JSONNumberingListStyleProperty.NumberingListIndex] = numberingStyle.numberingListIndex;
            jsonNumberingStyles.push(jsonNumberingStyle);
        }
        return jsonNumberingStyles;
    };
    JSONStylesExporter.exportTableStyles = function (documentModel) {
        var jsonTableStyles = [];
        for (var _i = 0, _a = documentModel.tableStyles; _i < _a.length; _i++) {
            var tableStyle = _a[_i];
            var jsonTableStyle = {};
            jsonTableStyle[json_style_enums_1.JSONStyleBaseProperty.StyleName] = tableStyle.styleName;
            jsonTableStyle[json_style_enums_1.JSONStyleBaseProperty.Deleted] = common_1.boolToInt(tableStyle.deleted);
            jsonTableStyle[json_style_enums_1.JSONStyleBaseProperty.Hidden] = common_1.boolToInt(tableStyle.hidden);
            jsonTableStyle[json_style_enums_1.JSONStyleBaseProperty.ParentStyleName] = tableStyle.parent ? tableStyle.parent.styleName : "";
            jsonTableStyle[json_style_enums_1.JSONStyleBaseProperty.Semihidden] = common_1.boolToInt(tableStyle.semihidden);
            jsonTableStyle[json_style_enums_1.JSONStyleBaseProperty.LocalizedStyleName] = tableStyle.localizedName;
            jsonTableStyle[json_style_enums_1.JSONStyleBaseProperty.IsDefault] = common_1.boolToInt(tableStyle.isDefault);
            jsonTableStyle[json_style_enums_1.JSONStyleBaseProperty.Base64EncodedImage] = tableStyle.base64EncodedImage;
            jsonTableStyle[json_style_enums_1.JSONTableStyleProperty.BaseConditionalStyle] =
                json_table_conditional_style_converter_1.JSONTableConditionalStyleConverter.convertToJSON(documentModel, tableStyle.baseConditionalStyle);
            jsonTableStyle[json_style_enums_1.JSONTableStyleProperty.ConditionalStyles] =
                json_table_conditional_style_converter_1.JSONTableConditionalStyleConverter.convertStylesToJSON(documentModel, tableStyle.conditionalStyles);
            jsonTableStyles.push(jsonTableStyle);
        }
        return jsonTableStyles;
    };
    JSONStylesExporter.importCharacterStyles = function (documentModel, content) {
        var maskedCharacterPropertiesCache = documentModel.cache.maskedCharacterPropertiesCache;
        var charStyles = documentModel.characterStyles;
        for (var _i = 0, content_1 = content; _i < content_1.length; _i++) {
            var jsonStyle = content_1[_i];
            charStyles.push(new character_style_1.CharacterStyle(jsonStyle[json_style_enums_1.JSONStyleBaseProperty.StyleName], jsonStyle[json_style_enums_1.JSONStyleBaseProperty.LocalizedStyleName], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Deleted], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Hidden], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Semihidden], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.IsDefault], maskedCharacterPropertiesCache.getItemByJsonKey(jsonStyle[json_style_enums_1.JSONCharacterStyleProperty.CharacterPropertiesCacheIndex]), jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Base64EncodedImage]));
        }
    };
    JSONStylesExporter.importParagraphStyles = function (documentModel, content) {
        var maskedCharacterPropertiesCache = documentModel.cache.maskedCharacterPropertiesCache;
        var maskedParagraphPropertiesCache = documentModel.cache.maskedParagraphPropertiesCache;
        var parStyles = documentModel.paragraphStyles;
        for (var _i = 0, content_2 = content; _i < content_2.length; _i++) {
            var jsonStyle = content_2[_i];
            parStyles.push(new paragraph_style_1.ParagraphStyle(jsonStyle[json_style_enums_1.JSONStyleBaseProperty.StyleName], jsonStyle[json_style_enums_1.JSONStyleBaseProperty.LocalizedStyleName], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Deleted], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Hidden], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Semihidden], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.IsDefault], maskedCharacterPropertiesCache.getItemByJsonKey(jsonStyle[json_style_enums_1.JSONParagraphStyleProperty.CharacterPropertiesCacheIndex]), maskedParagraphPropertiesCache.getItemByJsonKey(jsonStyle[json_style_enums_1.JSONParagraphStyleProperty.ParagraphPropertiesCacheIndex]), json_tab_converter_1.JSONTabConverter.convertFromJSONToTabProperties(jsonStyle[json_style_enums_1.JSONParagraphStyleProperty.Tabs]), !!jsonStyle[json_style_enums_1.JSONParagraphStyleProperty.AutoUpdate], jsonStyle[json_style_enums_1.JSONParagraphStyleProperty.NumberingListIndex], jsonStyle[json_style_enums_1.JSONParagraphStyleProperty.ListLevelIndex], jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Base64EncodedImage]));
        }
    };
    JSONStylesExporter.importNumberingStyles = function (documentModel, content) {
        var numListStyles = documentModel.numberingListStyles;
        for (var _i = 0, content_3 = content; _i < content_3.length; _i++) {
            var jsonStyle = content_3[_i];
            numListStyles.push(new numbering_list_style_1.NumberingListStyle(jsonStyle[json_style_enums_1.JSONStyleBaseProperty.StyleName], jsonStyle[json_style_enums_1.JSONStyleBaseProperty.LocalizedStyleName], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Deleted], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Hidden], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Semihidden], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.IsDefault], jsonStyle[json_style_enums_1.JSONNumberingListStyleProperty.NumberingListIndex]));
        }
    };
    JSONStylesExporter.importTableStyles = function (documentModel, content) {
        var tblStyles = documentModel.tableStyles;
        for (var _i = 0, content_4 = content; _i < content_4.length; _i++) {
            var jsonStyle = content_4[_i];
            tblStyles.push(new table_style_1.TableStyle(jsonStyle[json_style_enums_1.JSONStyleBaseProperty.StyleName], jsonStyle[json_style_enums_1.JSONStyleBaseProperty.LocalizedStyleName], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Deleted], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Hidden], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Semihidden], !!jsonStyle[json_style_enums_1.JSONStyleBaseProperty.IsDefault], json_table_conditional_style_converter_1.JSONTableConditionalStyleConverter.convertStylesFromJSON(jsonStyle[json_style_enums_1.JSONTableStyleProperty.ConditionalStyles], documentModel.cache), json_table_conditional_style_converter_1.JSONTableConditionalStyleConverter.convertFromJSON(jsonStyle[json_style_enums_1.JSONTableStyleProperty.BaseConditionalStyle], documentModel.cache), jsonStyle[json_style_enums_1.JSONStyleBaseProperty.Base64EncodedImage]));
        }
    };
    JSONStylesExporter.finishCharacterStylesImport = function (documentModel, content) {
        for (var i = 0, style; style = documentModel.characterStyles[i]; i++) {
            var jsonStyle = content[i];
            var parentStyleName = jsonStyle[json_style_enums_1.JSONStyleBaseProperty.ParentStyleName];
            if (parentStyleName)
                style.parent = documentModel.getCharacterStyleByName(parentStyleName);
            var linkedStyle = jsonStyle[json_style_enums_1.JSONCharacterStyleProperty.LinkedStyleName];
            if (linkedStyle !== undefined)
                style.linkedStyle = documentModel.getParagraphStyleByName(linkedStyle);
        }
    };
    JSONStylesExporter.finishParagraphStylesImport = function (documentModel, content) {
        for (var i = 0, style; style = documentModel.paragraphStyles[i]; i++) {
            var jsonStyle = content[i];
            var parentStyleName = jsonStyle[json_style_enums_1.JSONStyleBaseProperty.ParentStyleName];
            if (parentStyleName)
                style.parent = documentModel.getParagraphStyleByName(parentStyleName);
            var linkedStyle = jsonStyle[json_style_enums_1.JSONParagraphStyleProperty.LinkedStyleName];
            if (linkedStyle !== undefined)
                style.linkedStyle = documentModel.getCharacterStyleByName(linkedStyle);
            var nextParStyleName = jsonStyle[json_style_enums_1.JSONParagraphStyleProperty.NextParagraphStyleName];
            if (nextParStyleName !== undefined)
                style.nextParagraphStyle = documentModel.getParagraphStyleByName(nextParStyleName);
        }
    };
    JSONStylesExporter.finishNumberingListStylesImport = function (documentModel, content) {
        for (var i = 0, style; style = documentModel.numberingListStyles[i]; i++)
            style.parent = documentModel.getNumberingListStyleByName(content[i][json_style_enums_1.JSONStyleBaseProperty.ParentStyleName]);
    };
    JSONStylesExporter.finishTableStylesImport = function (documentModel, content) {
        for (var i = 0, style; style = documentModel.tableStyles[i]; i++)
            style.parent = documentModel.getTableStyleByName(content[i][json_style_enums_1.JSONStyleBaseProperty.ParentStyleName]);
    };
    return JSONStylesExporter;
}());
exports.JSONStylesExporter = JSONStylesExporter;
