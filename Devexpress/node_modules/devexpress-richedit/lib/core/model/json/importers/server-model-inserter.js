"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var fixed_1 = require("@devexpress/utils/lib/intervals/fixed");
var number_1 = require("@devexpress/utils/lib/utils/map/number");
var document_model_1 = require("../../document-model");
var sub_document_1 = require("../../sub-document");
var sub_document_infos_1 = require("../../sub-document-infos");
var json_document_enums_1 = require("../enums/json-document-enums");
var json_field_enums_1 = require("../enums/json-field-enums");
var web_caches_exporter_1 = require("../web-caches-exporter");
var image_cache_info_converter_1 = require("./image-cache-info-converter");
var json_drawing_color_converter_1 = require("./json-drawing-color-converter");
var json_importer_1 = require("./json-importer");
var json_styles_exporter_1 = require("./json-styles-exporter");
var json_numbering_list_importer_1 = require("./numbering-list/json-numbering-list-importer");
var ServerModelInserter = (function () {
    function ServerModelInserter() {
    }
    ServerModelInserter.insertDocumentModelFromServer = function (modelManager, response, insertToPos, insertToSubDocumentId) {
        var model = modelManager.model;
        var newDocumentModel = new document_model_1.DocumentModel(model.modelOptions, 0);
        newDocumentModel.cache.fontInfoCache = model.cache.fontInfoCache;
        newDocumentModel.cache.imageCache = model.cache.imageCache;
        var cachesExporter = new web_caches_exporter_1.WebCachesExporter(newDocumentModel.cache, response[json_field_enums_1.JSONUpdateFieldCommandResult.Caches], newDocumentModel);
        var imageCorrespondence = response[json_field_enums_1.JSONUpdateFieldCommandResult.ImageCorrespondence];
        ServerModelInserter.processNewDocumentResponse(newDocumentModel, imageCorrespondence, response[json_field_enums_1.JSONUpdateFieldCommandResult.DocumentModel]);
        cachesExporter.importSubDocuments(modelManager.richOptions.documentProtection, imageCorrespondence);
        var subDocument = model.subDocuments[insertToSubDocumentId];
        var resultInterval = modelManager.modelManipulator.subDocument.insertSubDocument(new sub_document_1.SubDocumentPosition(subDocument, insertToPos), new sub_document_1.SubDocumentInterval(newDocumentModel.mainSubDocument, new fixed_1.FixedInterval(0, response[json_field_enums_1.JSONUpdateFieldCommandResult.DocumentLength])));
        cachesExporter.dispose();
        return resultInterval;
    };
    ServerModelInserter.processNewDocumentResponse = function (documentModel, imageCorrespondence, obj) {
        json_importer_1.JSONImporter.importDocumentProperties(documentModel, obj[json_document_enums_1.JSONDocumentModelProperty.DocumentProperties]);
        json_importer_1.JSONImporter.importCompatibilitySettings(documentModel, obj[json_document_enums_1.JSONDocumentModelProperty.CompatibilitySettings]);
        json_styles_exporter_1.JSONStylesExporter.importStyles(documentModel, obj[json_document_enums_1.JSONDocumentModelProperty.Styles]);
        json_importer_1.JSONImporter.importModelHeaderFooter(documentModel.headers, obj[json_document_enums_1.JSONDocumentModelProperty.Headers], sub_document_infos_1.HeaderSubDocumentInfo);
        json_importer_1.JSONImporter.importModelHeaderFooter(documentModel.footers, obj[json_document_enums_1.JSONDocumentModelProperty.Footers], sub_document_infos_1.FooterSubDocumentInfo);
        json_importer_1.JSONImporter.importSections(documentModel, obj[json_document_enums_1.JSONDocumentModelProperty.Sections]);
        json_numbering_list_importer_1.JSONNumberingListImporter.importAbstractNumberingLists(documentModel, obj[json_document_enums_1.JSONDocumentModelProperty.AbstractNumberingLists]);
        json_numbering_list_importer_1.JSONNumberingListImporter.importNumberingLists(documentModel, obj[json_document_enums_1.JSONDocumentModelProperty.NumberingLists]);
        json_numbering_list_importer_1.JSONNumberingListImporter.importAbstractNumberingListTemplates(documentModel, obj[json_document_enums_1.JSONDocumentModelProperty.AbstractNumberingListTemplates]);
        image_cache_info_converter_1.JSONCacheImageInfoConverter.importImageCache(documentModel.cache.imageCache, imageCorrespondence, obj[json_document_enums_1.JSONDocumentModelProperty.Images]);
        var paletteColors = obj[json_document_enums_1.JSONDocumentModelProperty.PaletteColors];
        number_1.NumberMapUtils.forEach(paletteColors, function (color, index) { return documentModel.colorProvider.palette.setColor(index, color); });
        var officeThemeColors = obj[json_document_enums_1.JSONDocumentModelProperty.OfficeThemeColors];
        number_1.NumberMapUtils.forEach(officeThemeColors, function (color, index) {
            return documentModel.colorProvider.officeTheme.colors.setDrawingColor(index, json_drawing_color_converter_1.JSONDrawingColorConverter.convertFromJSON(color));
        });
    };
    return ServerModelInserter;
}());
exports.ServerModelInserter = ServerModelInserter;
