"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var enum_1 = require("@devexpress/utils/lib/utils/enum");
var list_1 = require("@devexpress/utils/lib/utils/list");
var paragraph_properties_1 = require("../paragraph/paragraph-properties");
var table_style_paragraph_properties_merger_1 = require("../tables/properties-mergers/table-style-paragraph-properties-merger");
var properties_merger_base_1 = require("./properties-merger-base");
var ParagraphPropertiesMerger = (function (_super) {
    tslib_1.__extends(ParagraphPropertiesMerger, _super);
    function ParagraphPropertiesMerger() {
        return _super.call(this, new paragraph_properties_1.MaskedParagraphProperties(), ParagraphPropertiesMerger.fields) || this;
    }
    ParagraphPropertiesMerger.prototype.mergeMaskedParagraphProperties = function (maskedParagraphProperties) {
        this.merge(maskedParagraphProperties);
    };
    ParagraphPropertiesMerger.prototype.mergeOnlyOwnCharacterProperties = function (sourceProperties, parentProperties) {
        var _this = this;
        this.mergeOnlyOwnProperties(sourceProperties, parentProperties);
        this.mergeOnlyOwnInternal(sourceProperties, parentProperties, paragraph_properties_1.ParagraphPropertiesMask.UseFirstLineIndent, function () {
            _this.innerProperties.firstLineIndent = sourceProperties.firstLineIndent;
            _this.innerProperties.firstLineIndentType = sourceProperties.firstLineIndentType;
        }, function () {
            return sourceProperties.firstLineIndent == parentProperties.firstLineIndent &&
                sourceProperties.firstLineIndentType == parentProperties.firstLineIndentType;
        });
        this.mergeOnlyOwnInternal(sourceProperties, parentProperties, paragraph_properties_1.ParagraphPropertiesMask.UseLineSpacing, function () {
            _this.innerProperties.lineSpacing = sourceProperties.lineSpacing;
            _this.innerProperties.lineSpacingType = sourceProperties.lineSpacingType;
        }, function () {
            return sourceProperties.lineSpacing == parentProperties.lineSpacing &&
                sourceProperties.lineSpacingType == parentProperties.lineSpacingType;
        });
    };
    ParagraphPropertiesMerger.prototype.mergeParagraphStyle = function (paragraphStyle) {
        var currentParagraphStyle = paragraphStyle;
        while (currentParagraphStyle) {
            this.merge(currentParagraphStyle.maskedParagraphProperties);
            currentParagraphStyle = currentParagraphStyle.parent;
        }
    };
    ParagraphPropertiesMerger.prototype.mergeTableStyle = function (tableCell) {
        var tableStyle = tableCell.parentRow.parentTable.style;
        var fakeContainer = new paragraph_properties_1.MaskedParagraphProperties();
        fakeContainer.useValue = paragraph_properties_1.ParagraphPropertiesMask.UseNone;
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.alignment, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerAlignment().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.shadingInfo, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerShadingInfo().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.leftIndent, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerLeftIndent().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.rightIndent, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerRightIndent().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.topBorder, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerTopBorder().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.keepWithNext, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerKeepWithNext().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.outlineLevel, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerOutlineLevel().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.spacingAfter, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerSpacingAfter().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.leftBorder, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerLeftBorder().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.spacingBefore, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerSpacingBefore().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.rightBorder, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerRightBorder().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.bottomBorder, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerBottomBorder().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.betweenBorder, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerBetweenBorder().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.pageBreakBefore, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerPageBreakBefore().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.afterAutoSpacing, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerAfterAutoSpacing().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.keepLinesTogether, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerKeepLinesTogether().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.beforeAutoSpacing, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerBeforeAutoSpacing().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.contextualSpacing, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerContextualSpacing().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.widowOrphanControl, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerWidowOrphanControl().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.suppressHyphenation, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerSuppressHyphenation().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.suppressLineNumbers, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerSuppressLineNumbers().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.firstLineIndent, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerFirstLineIndent().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.firstLineIndentType, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerFirstLineIndentType().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.lineSpacing, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerLineSpacing().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.lineSpacingType, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerLineSpacingType().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.divId, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerDivId().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
        this.mergeTableProperties(paragraph_properties_1.ParagraphPropertyDescriptor.rightToLeft, function () { return new table_style_paragraph_properties_merger_1.TableStyleParagraphPropertiesMergerRightToLeft().getProperty(fakeContainer, tableStyle, tableCell.conditionalFormatting, null); });
    };
    ParagraphPropertiesMerger.prototype.getMergedProperties = function () {
        var result = new paragraph_properties_1.ParagraphProperties();
        result.copyFrom(this.innerProperties);
        return result;
    };
    ParagraphPropertiesMerger.prototype.merge = function (properties) {
        var _this = this;
        if (!properties)
            return;
        this.mergeAll(properties);
        this.mergeInternal(properties, paragraph_properties_1.ParagraphPropertiesMask.UseFirstLineIndent, function () {
            _this.innerProperties.firstLineIndent = properties.firstLineIndent;
            _this.innerProperties.firstLineIndentType = properties.firstLineIndentType;
        });
        this.mergeInternal(properties, paragraph_properties_1.ParagraphPropertiesMask.UseLineSpacing, function () {
            _this.innerProperties.lineSpacing = properties.lineSpacing;
            _this.innerProperties.lineSpacingType = properties.lineSpacingType;
        });
    };
    ParagraphPropertiesMerger.fields = list_1.ListUtils.reducedMap(paragraph_properties_1.ParagraphPropertyDescriptor.ALL_FIELDS, function (f) {
        return enum_1.EnumUtils.isAnyOf(f.maskValue(), paragraph_properties_1.ParagraphPropertiesMask.UseFirstLineIndent, paragraph_properties_1.ParagraphPropertiesMask.UseLineSpacing) ? null : f;
    });
    return ParagraphPropertiesMerger;
}(properties_merger_base_1.PropertiesMergerBase));
exports.ParagraphPropertiesMerger = ParagraphPropertiesMerger;
