"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var TableCellsComparer = (function () {
    function TableCellsComparer() {
        this.cache = {};
    }
    TableCellsComparer.prototype.reset = function () {
        this.cache = {};
    };
    TableCellsComparer.prototype.isEquivalent = function (layoutRowA, layoutRowB) {
        var tableCellA = layoutRowA.tableCellInfo;
        var tableCellB = layoutRowB.tableCellInfo;
        if (!tableCellA && !tableCellB)
            return true;
        if (tableCellA && !tableCellB || !tableCellA && tableCellB)
            return false;
        return this.isCellsEquivalent(tableCellA, tableCellB) &&
            TableCellsComparer.rowsEqualIndex(tableCellA, layoutRowA, tableCellB, layoutRowB);
    };
    TableCellsComparer.prototype.isCellsEquivalent = function (tableCellA, tableCellB) {
        var keyA = TableCellsComparer.getKey(tableCellA);
        var keyB = TableCellsComparer.getKey(tableCellB);
        var cache = this.cache[keyA];
        if (!cache)
            cache = this.cache[keyA] = {};
        var cacheCellsEquivalent = cache[keyB];
        return cacheCellsEquivalent === undefined ? cache[keyB] = TableCellsComparer.compareCells(tableCellA, tableCellB) : cacheCellsEquivalent;
    };
    TableCellsComparer.compareCells = function (tableCellA, tableCellB) {
        var tableRowA = tableCellA.parentRow;
        var tableRowB = tableCellB.parentRow;
        var tableA = tableRowA.parentTable;
        var tableB = tableRowB.parentTable;
        return tableA.logicInfo.grid.table == tableB.logicInfo.grid.table &&
            tableRowA.rowIndex == tableRowB.rowIndex &&
            tableCellA.cellGridIndex == tableCellB.cellGridIndex &&
            tableCellA.layoutRows.length == tableCellB.layoutRows.length &&
            TableCellsComparer.equalLengthAndPosition(tableRowA.rowCells, tableCellA, tableRowB.rowCells, tableCellB) &&
            TableCellsComparer.equalLengthAndPosition(tableA.tableRows, tableRowA, tableB.tableRows, tableRowB);
    };
    TableCellsComparer.equalLengthAndPosition = function (listA, elemA, listB, elemB) {
        return listA.length == listB.length && listA.indexOf(elemA) == listB.indexOf(elemB);
    };
    TableCellsComparer.getKey = function (tableCellA) {
        var row = tableCellA.parentRow;
        return row.parentTable.logicInfo.grid.table.index << (16 * 2) | row.rowIndex << 16 | tableCellA.cellGridIndex;
    };
    TableCellsComparer.rowsEqualIndex = function (tableCellA, layoutRowA, tableCellB, layoutRowB) {
        return tableCellA.layoutRows.indexOf(layoutRowA) == tableCellB.layoutRows.indexOf(layoutRowB);
    };
    return TableCellsComparer;
}());
exports.TableCellsComparer = TableCellsComparer;
